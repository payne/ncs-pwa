<div class="container-fluid">
  <h1>NET Assignments</h1>

  <!-- Assignment Form -->
  <div class="form-container">
    <h2>Add New Assignment</h2>
    <form [formGroup]="assignmentForm" (ngSubmit)="addAssignment()">
      <div class="row">
        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Callsign</mat-label>
            <input matInput formControlName="callsign" (input)="onSearchOperator($any($event.target).value)">
            <mat-error *ngIf="assignmentForm.get('callsign')?.hasError('required')">
              Callsign is required
            </mat-error>
          </mat-form-field>
          <div class="autocomplete-results" *ngIf="filteredOperators.length > 0">
            <div
              class="autocomplete-item"
              *ngFor="let operator of filteredOperators"
              (click)="selectOperator(operator)">
              {{ operator.callsign }} - {{ operator.name }}
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Time In</mat-label>
            <input matInput type="time" formControlName="timeIn">
            <mat-error *ngIf="assignmentForm.get('timeIn')?.hasError('required')">
              Time In is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Name</mat-label>
            <input matInput formControlName="name" (input)="onSearchOperator($any($event.target).value)">
            <mat-error *ngIf="assignmentForm.get('name')?.hasError('required')">
              Name is required
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Duty</mat-label>
            <input matInput formControlName="duty">
            <mat-error *ngIf="assignmentForm.get('duty')?.hasError('required')">
              Duty is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Milage Start</mat-label>
            <input matInput type="number" formControlName="milageStart">
            <mat-error *ngIf="assignmentForm.get('milageStart')?.hasError('required')">
              Milage Start is required
            </mat-error>
            <mat-error *ngIf="assignmentForm.get('milageStart')?.hasError('min')">
              Milage must be positive
            </mat-error>
          </mat-form-field>
        </div>

        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Classification</mat-label>
            <input matInput formControlName="classification">
            <mat-error *ngIf="assignmentForm.get('classification')?.hasError('required')">
              Classification is required
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <button mat-raised-button color="primary" type="submit" [disabled]="!assignmentForm.valid">
            Add Assignment
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- Filter -->
  <div class="filter-container">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Filter Assignments</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Search...">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Assignments Table -->
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

      <!-- Callsign Column -->
      <ng-container matColumnDef="callsign">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Callsign</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.callsign }}</span>
          <input *ngIf="assignment.isEditing" [(ngModel)]="assignment.callsign" class="edit-input">
        </td>
      </ng-container>

      <!-- Time In Column -->
      <ng-container matColumnDef="timeIn">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Time In</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.timeIn }}</span>
          <input *ngIf="assignment.isEditing" type="time" [(ngModel)]="assignment.timeIn" class="edit-input">
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.name }}</span>
          <input *ngIf="assignment.isEditing" [(ngModel)]="assignment.name" class="edit-input">
        </td>
      </ng-container>

      <!-- Duty Column -->
      <ng-container matColumnDef="duty">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Duty</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.duty }}</span>
          <input *ngIf="assignment.isEditing" [(ngModel)]="assignment.duty" class="edit-input">
        </td>
      </ng-container>

      <!-- Milage Start Column -->
      <ng-container matColumnDef="milageStart">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Milage Start</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.milageStart }}</span>
          <input *ngIf="assignment.isEditing" type="number" [(ngModel)]="assignment.milageStart" class="edit-input">
        </td>
      </ng-container>

      <!-- Classification Column -->
      <ng-container matColumnDef="classification">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Classification</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.classification }}</span>
          <input *ngIf="assignment.isEditing" [(ngModel)]="assignment.classification" class="edit-input">
        </td>
      </ng-container>

      <!-- Time Out Column -->
      <ng-container matColumnDef="timeOut">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Time Out</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.timeOut }}</span>
          <input *ngIf="assignment.isEditing" type="time" [(ngModel)]="assignment.timeOut" class="edit-input">
        </td>
      </ng-container>

      <!-- Milage End Column -->
      <ng-container matColumnDef="milageEnd">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Milage End</th>
        <td mat-cell *matCellDef="let assignment">
          <span *ngIf="!assignment.isEditing">{{ assignment.milageEnd }}</span>
          <input *ngIf="assignment.isEditing" type="number" [(ngModel)]="assignment.milageEnd" class="edit-input">
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let assignment">
          <div *ngIf="!assignment.isEditing">
            <button mat-icon-button color="primary" (click)="enableEdit(assignment)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteAssignment(assignment)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <div *ngIf="assignment.isEditing">
            <button mat-icon-button color="primary" (click)="saveEdit(assignment)">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="cancelEdit(assignment)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>
